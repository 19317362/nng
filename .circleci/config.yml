# Debian packages we want (makes life better);
#
# - asciidoctor
# - cmake
# - libmbedtls-dev
# - ninja-build
# - clang
# - clang-format
# - gcc (-7?)
# - g++ (-7?)
#
version: 2
jobs:
  build-osx:
    macos:
      xcode: "9.0"
    steps:
        - checkout:
        - run:
            name: Install Dependencies
            command: brew install cmake mbedtls asciidoctor ninja

        - run:
            name: Configure
            command: mkdir build && cd build && cmake -DNNG_TRANSPORT_TLS=ON -G Ninja ..

        - run:
            name: Build
            command: cd build && ninja

        - run:
            name: Run Tests
            command: cd build && ninja test


  build-debian:
    docker:
      - image: debian:stretch
    steps:
      - checkout
      - run:
          name: Install Dependencies
          command: apt-get update -qq && apt-get install -y build-essential asciidoctor cmake libmbedtls-dev ninja-build clang clang-format

      - run:
          name: Configure
          command: mkdir build && cd build && cmake -DNNG_TRANSPORT_TLS=ON -G Ninja ..

      - run:
          name: Build
          command: cd build && ninja

      - run:
          name: Run Tests
          command: cd build && ninja test

#      - run:
#          name: Check Format
#          command: ./etc/format-check.sh
workflows:
  version: 2
  build-test-lint:
    jobs:
      - build-osx
      - build-debian
